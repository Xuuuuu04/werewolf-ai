# 🎮 狼人杀游戏启动说明

## 快速开始

### 方式一：使用启动器（推荐）

直接运行启动器脚本：

```bash
python start_game.py
```

启动器提供了友好的交互式界面，支持以下功能：

#### 📋 游戏模式选项

1. **🤖 Qwen vs Qwen** - AI模型对战（Qwen3-Coder-Plus）
   - 使用Qwen3-Coder-Plus模型的狼人和村民对战
   
2. **🤖 Qwen vs GPT** - Qwen对战GPT
   - Qwen模型担任狼人，GPT模型担任村民
   
3. **👤 人类 vs Qwen** - 人类玩家对战AI
   - 人类玩家担任狼人，Qwen AI担任村民
   
4. **🤖 GPT vs MaKTO** - GPT对战MaKTO模型
   - GPT模型对战训练后的MaKTO模型
   
5. **🤖 SFT vs MaKTO** - SFT对战MaKTO模型
   - SFT模型对战MaKTO模型
   
6. **👤 人类 vs MaKTO** - 人类玩家对战MaKTO
   - 人类玩家对战训练后的MaKTO模型
   
7. **👤 人类 vs SFT** - 人类玩家对战SFT
   - 人类玩家对战SFT模型
   
8. **🎲 随机模式** - 随机多模型混合对战
   - 多种AI模型随机混合对战

9. **📊 查看游戏日志** - 可视化游戏记录
   - 启动游戏日志可视化工具

#### 🎯 启动器功能

- **自动生成日志路径**：系统自动创建带时间戳的日志目录
- **自定义日志路径**：可以指定保存游戏日志的位置
- **选择不保存日志**：如果不需要保存日志
- **设置游戏局数**：可以连续玩多局游戏
- **友好的用户界面**：清晰的菜单和提示信息

### 方式二：命令行直接运行

使用命令行参数直接启动游戏：

```bash
# 基本用法
python run_battle.py --config configs/qwen_vs_qwen.yaml

# 保存游戏日志
python run_battle.py --config configs/qwen_vs_qwen.yaml --log_save_path ./game_logs/game_1

# 运行多局游戏
python run_battle.py --config configs/qwen_vs_qwen.yaml --log_save_path ./game_logs/game_1 --num_games 5
```

## 📁 配置文件

所有游戏配置文件位于 `configs/` 目录：

- `qwen_vs_qwen.yaml` - Qwen自我对战配置
- `qwen_vs_gpt.yaml` - Qwen对战GPT配置
- `human_vs_qwen.yaml` - 人类对战Qwen配置
- `gpt4_vs_makto.yaml` - GPT-4对战MaKTO配置
- `sft_vs_makto.yaml` - SFT对战MaKTO配置
- `human_vs_makto.yaml` - 人类对战MaKTO配置
- `human_vs_sft.yaml` - 人类对战SFT配置
- `random_models.yaml` - 随机模型配置

## 🔧 当前模型配置

项目当前使用的API配置：

- **API端点**: `https://apis.iflow.cn/v1/chat/completions`
- **API密钥**: `sk-f3ee5353f375f45271fd55792e91564a`
- **模型名称**: `qwen3-coder-plus`

如需修改模型配置，请编辑对应的YAML配置文件。

## 📊 游戏日志

游戏日志保存在指定的目录中，包含：

- `game_log.json` - 完整的游戏日志（JSON格式）
- `Player_X.jsonl` - 每个玩家的日志记录

可以使用可视化工具查看游戏记录：

```bash
python script/game_visualizer.py
```

## 🎭 游戏规则

### 角色配置

默认9人局配置：
- 🐺 狼人 × 3
- 🔮 预言家 × 1
- 🛡️ 守卫 × 1
- 🧪 女巫 × 1
- 👥 村民 × 3

### 游戏流程

1. **夜晚阶段**
   - 狼人选择猎杀目标
   - 预言家查验身份
   - 守卫守护玩家
   - 女巫使用解药或毒药

2. **白天阶段**
   - 公布死亡信息
   - 玩家依次发言
   - 投票放逐玩家
   - 如有平票，进入PK环节

3. **胜利条件**
   - 🐺 狼人胜利：狼人数量 ≥ 好人数量
   - 👥 村民胜利：所有狼人被淘汰

## 🎮 人类玩家操作指南

### 发言阶段
在发言阶段，你需要输入你的发言内容。可以：
- 分享你的身份信息
- 分析局势
- 投票建议
- 质疑其他玩家

### 动作阶段
在动作阶段（如狼人杀人、预言家查验等），系统会显示可选动作列表：

```
📋 可选动作列表：
============================================================
  [0] {'杀害':'否'}
  [1] {'杀害':'1'}
  [2] {'杀害':'2'}
  ...
============================================================
```

**两种输入方式**：
1. **输入索引号**（推荐）：直接输入数字，如 `1` 表示选择第1个动作
2. **输入完整字符串**：输入完整的动作字符串，如 `{'杀害':'1'}`

### 投票阶段
选择你想要投票放逐的玩家编号，或选择弃票。

## 🐛 常见问题

### 1. 启动时提示找不到配置文件

确保在项目根目录下运行脚本，并且 `configs/` 目录存在。

### 2. API调用失败

检查：
- 网络连接是否正常
- API密钥是否有效
- API端点是否正确

### 3. 模块导入错误

确保已安装所有依赖：

```bash
conda activate werewolf
pip install -r requirements.txt
```

或手动安装：

```bash
pip install gymnasium openai transformers tenacity pyyaml torch tiktoken
```

## 💡 使用技巧

1. **首次运行建议**：先使用 "Qwen vs Qwen" 模式测试AI模型是否正常工作
2. **保存重要对局**：使用有意义的日志路径名称，方便后续查找
3. **调试模式**：可以查看日志文件了解AI的决策过程
4. **批量测试**：设置多局游戏可以统计胜率和模型表现

## 📝 更新日志

### 当前版本特性

- ✅ 完整的中文化界面
- ✅ 支持多种AI模型
- ✅ 交互式游戏启动器
- ✅ 详细的游戏日志记录
- ✅ 可视化工具
- ✅ 灵活的配置系统

## 🤝 贡献

如有问题或建议，欢迎提出Issue或Pull Request！

---

**祝你游戏愉快！🎉**

